<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Content Manager</title>
</head>
<body>
<h1 style="text-align:center;margin-top:2rem;">Content Manager Login</h1>

<!-- Decap CMS -->
<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
<!-- Netlify Identity Widget -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<script>
    // Initialize Netlify Identity
    if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
            if (!user) {
                window.netlifyIdentity.on("login", () => {
                    document.location.href = "/admin/";
                });
            }
        });
        window.netlifyIdentity.init();
    }

    // Init Decap CMS
    CMS.init({
        config: {
            backend: {
                name: "git-gateway",
                branch: "main",       // or your default branch
            },
            media_folder: "static/images/uploads",
            public_folder: "/images/uploads",
            collections: [
                {
                    name: "blog",
                    label: "Blog Posts",
                    folder: "content/blog",
                    create: true,
                    slug: "{{slug}}",
                    fields: [
                        {label: "Title", name: "title", widget: "string"},
                        {label: "Date", name: "date", widget: "datetime"},
                        {
                            label: "Author",
                            name: "author",
                            widget: "relation",
                            collection: "authors",
                            search_fields: ["name"],
                            value_field: "name"
                        },
                        {label: "Body", name: "body", widget: "markdown"},
                        {label: "Summary", name: "summary", widget: "text"},
                        {
                            label: "Slides", name: "slides", widget: "list", fields: [
                                {label: "Image", name: "image", widget: "image"},
                                {label: "Subtitle", name: "subtitle", widget: "string"}
                            ]
                        }
                    ]
                },
                {
                    name: "authors",
                    label: "Authors",
                    folder: "content/authors",
                    create: true,
                    slug: "{{slug}}",
                    fields: [
                        {label: "Name", name: "name", widget: "string"},
                        {label: "Job", name: "job", widget: "string"},
                        {label: "Avatar", name: "avatar", widget: "image"}
                    ]
                },
                {
                    name: "games",
                    label: "Games",
                    folder: "content/games",
                    create: true,
                    slug: "{{slug}}",
                    fields: [
                        {label: "Title", name: "title", widget: "string"},
                        {label: "Description", name: "description", widget: "text"},
                        {
                            label: "Images", name: "images", widget: "list", fields: [
                                {label: "Image", name: "image", widget: "image"}
                            ]
                        },
                        {
                            label: "Platforms", name: "platforms", widget: "list", fields: [
                                {label: "Platform Image", name: "icon", widget: "image"}
                            ]
                        }
                    ]
                }
            ]
        }
    });
</script>
</body>
</html>