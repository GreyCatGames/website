<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Content Manager</title>
</head>
<body>
<!-- Decap CMS (formerly Netlify CMS) -->
<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

<!-- Auth0 SDK -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const auth0 = await createAuth0Client({
            domain: "{{ getenv "AUTH0_DOMAIN" }}",
            client_id: "{{ getenv "AUTH0_CLIENT_ID" }}"
        });

        // If returning from Auth0
        if (window.location.search.includes("code=") &&
            window.location.search.includes("state=")) {
            await auth0.handleRedirectCallback();
            window.history.replaceState({}, document.title, "/admin/");
        }

        const isAuthenticated = await auth0.isAuthenticated();

        if (!isAuthenticated) {
            // redirect to Auth0 login
            await auth0.loginWithRedirect({
                redirect_uri: window.location.origin + "/admin/"
            });
        }

        // User is authenticated â†’ init CMS
        if (isAuthenticated) {
            CMS.init();
        }
    });
</script>
</body>
</html>